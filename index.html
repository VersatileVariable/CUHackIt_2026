<!DOCTYPE html>
<!--
    ClearPath AR - Accessibility Wearable for Meta Quest 3
    
    DEPLOYMENT MODES:
    1. Cloud (Vercel/ngrok) - Speech, Audio, AI features only
    2. Local Network - All features including iPhone haptic feedback
    
    The app automatically detects deployment mode and disables
    iPhone bridge when accessed via public URLs.
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ClearPath - AR Accessibility Wearable</title>
    
    <!-- A-Frame WebXR Framework -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- A-Frame WebXR Extras for AR -->
    <script src="https://cdn.jsdelivr.net/gh/supermedium/superframe@master/components/environment/dist/aframe-environment-component.min.js"></script>
    
    <!-- ClearPath AR Styles -->
    <link rel="stylesheet" href="css/ar-styles.css?v=2.2">
    
    <!-- ClearPath JavaScript Modules - Quest compatibility MUST load first -->
    <script src="js/quest-compatibility.js"></script>
    <script src="js/websocket-bridge.js"></script>
    <script src="js/speech-recognition.js"></script>
    <script src="js/ai-summarizer.js"></script>
    <script src="js/ar-manager.js"></script>
    
    <script>
        // WebXR AR Configuration with Camera Access
        AFRAME.registerComponent('ar-mode', {
            init: function () {
                const sceneEl = this.el;
                
                // Enable AR mode and passthrough camera
                sceneEl.addEventListener('enter-vr', function () {
                    console.log('Entering AR mode - camera passthrough active');
                    document.body.classList.add('ar-active');
                    
                    // Request camera access for passthrough
                    const xrSession = sceneEl.xrSession;
                    if (xrSession) {
                        console.log('XR Session active - passthrough enabled');
                    }
                });
                
                sceneEl.addEventListener('exit-vr', function () {
                    console.log('Exiting AR mode');
                    document.body.classList.remove('ar-active');
                });
            }
        });
        
        // Quest passthrough helper
        AFRAME.registerComponent('quest-passthrough', {
            init: function() {
                const sceneEl = this.el.sceneEl;
                
                sceneEl.addEventListener('enter-vr', async () => {
                    const session = sceneEl.xrSession;
                    if (session && session.environmentBlendMode) {
                        console.log('XR Session Started');
                        console.log('   Blend Mode:', session.environmentBlendMode);
                        console.log('   Session Mode:', session.mode);
                        
                        // Request microphone permission for speech recognition
                        try {
                            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                            console.log('Microphone access granted');
                            // Stop the test stream, speech recognition will request again
                            stream.getTracks().forEach(track => track.stop());
                        } catch (err) {
                            console.error('Microphone access denied:', err);
                        }
                        
                        // Enable camera passthrough for Quest MR
                        if (session.environmentBlendMode === 'opaque') {
                            console.log('Opaque blend mode - passthrough may not work');
                        } else {
                            console.log('Quest passthrough active:', session.environmentBlendMode);
                        }
                        
                        // Make scene background truly transparent
                        const scene = sceneEl.object3D;
                        if (scene.background) {
                            scene.background = null;
                            console.log('Scene background cleared for passthrough');
                        }
                    }
                });
                
                sceneEl.addEventListener('exit-vr', () => {
                    console.log('Exited VR mode');
                });
            }
        });
    </script>
</head>
<body>
    <!-- WebXR DOM Overlay (required for UI elements in AR) -->
    <div id="overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
        <!-- Child elements with pointer-events: auto will be interactive -->
    </div>
    
    <!-- AR Scene Container -->
    <a-scene 
        embedded 
        webxr="requiredFeatures: local-floor; optionalFeatures: unbounded,dom-overlay,hand-tracking,layers; overlayElement: #overlay;"
        renderer="colorManagement: true; physicallyCorrectLights: true; alpha: true; antialias: true; foveationLevel: 1;"
        vr-mode-ui="enabled: true; enterVRButton: #enterVRButton;"
        ar-mode
        quest-passthrough
    >
        <!-- Assets -->
        <a-assets>
            <!-- Fonts optimized for AR readability -->
            <a-mixin id="caption-font" 
                     text="font: roboto; 
                           color: #FFFFFF; 
                           shader: sdf; 
                           side: double;
                           opacity: 0.95;
                           align: center;
                           wrapCount: 40;
                           letterSpacing: 1;">
            </a-mixin>
            
            <a-mixin id="topic-font"
                     text="font: roboto;
                           color: #E8F4FD;
                           shader: sdf;
                           side: double;
                           opacity: 0.9;
                           align: left;
                           wrapCount: 25;
                           letterSpacing: 0;">
            </a-mixin>
            
            <a-mixin id="dashboard-font"
                     text="font: roboto;
                           color: #FFFFFF;
                           shader: sdf;
                           side: double;
                           opacity: 1.0;
                           align: left;
                           wrapCount: 35;
                           letterSpacing: 0;">
            </a-mixin>
        </a-assets>

        <!-- AR Camera with Passthrough -->
        <a-camera 
            id="arCamera"
            position="0 1.6 0"
            look-controls="enabled: true"
            wasd-controls="enabled: false"
            cursor="rayOrigin: mouse; fuse: true; fuseTimeout: 1500"
            raycaster="objects: .clickable"
        >
            <!-- VR Cursor Indicator (Small Dot) -->
            <a-ring 
                position="0 0 -1.5" 
                radius-inner="0.002" 
                radius-outer="0.005" 
                color="#10B981" 
                opacity="0.6">
            </a-ring>
            <!-- 1. LIVE CAPTION BAR (Lower Third) -->
            <a-entity id="captionBar" position="0 -1.0 -2.5">
                <!-- Caption Background -->
                <a-box 
                    id="captionBg"
                    position="0 0 0"
                    width="3.0"
                    height="0.35"
                    depth="0.01"
                    color="#1F2937"
                    opacity="0.95"
                    visible="true">
                </a-box>
                
                <!-- Caption Text -->
                <a-text 
                    id="captionText"
                    text="font: roboto; 
                          color: #FFFFFF; 
                          shader: sdf; 
                          side: double;
                          opacity: 1.0;
                          align: center;
                          wrapCount: 70;
                          letterSpacing: 0;
                          baseline: center;
                          value: Captions will be added here;"
                    position="0 0 0.02"
                    width="2.8"
                    visible="true">
                </a-text>
            </a-entity>

            <!-- 2. TOPIC BOX (Center) -->
            <a-entity id="topicBox" position="0 -0.6 -2.5">
                <!-- Topic Background -->
                <a-box 
                    id="topicBg"
                    position="0 0 0"
                    width="2.2"
                    height="0.3"
                    depth="0.01"
                    color="#1F2937"
                    opacity="0.95"
                    visible="false">
                </a-box>
                
                <!-- Topic Content -->
                <a-text 
                    id="topicContent"
                    mixin="topic-font"
                    position="0 0 0.01"
                    value="Topic of conversation"
                    width="2.0"
                    color="#FFFFFF"
                    align="center"
                    visible="false">
                </a-text>
            </a-entity>

            <!-- 3. DASHBOARD PANEL (Right Side) -->
            <a-entity id="dashboardPanel" position="1.1 0.0 -2.8">
                <!-- Dashboard Background -->
                <a-box 
                    id="dashboardBg"
                    position="0 0 0"
                    width="1.8"
                    height="0.5"
                    depth="0.01"
                    color="#1F2937"
                    opacity="0.95"
                    visible="true">
                </a-box>
                
                <!-- Person Name -->
                <a-text 
                    id="dashboardName"
                    text="font: roboto;
                          color: #FFFFFF;
                          shader: sdf;
                          side: double;
                          opacity: 1.0;
                          align: left;
                          wrapCount: 35;
                          letterSpacing: 0;
                          value: Person's Name: ...;"
                    position="-0.85 0.15 0.02"
                    width="1.6"
                    visible="true">
                </a-text>
                
                <!-- Relationship -->
                <a-text 
                    id="dashboardRelation"
                    text="font: roboto;
                          color: #E5E7EB;
                          shader: sdf;
                          side: double;
                          opacity: 1.0;
                          align: left;
                          wrapCount: 35;
                          letterSpacing: 0;
                          value: Relationship: ...;"
                    position="-0.85 -0.15 0.02"
                    width="1.6"
                    visible="true">
                </a-text>
            </a-entity>

            <!-- 4. AR MODE TOGGLES (Left Side Vertical) -->
            <a-entity id="arToggles" position="-1.3 0.1 -2.8">
                <!-- Toggle Background -->
                <a-box 
                    position="0 0 0"
                    width="0.9"
                    height="0.8"
                    depth="0.01"
                    color="#1F2937"
                    opacity="0.95">
                </a-box>
                
                <!-- Caption Toggle -->
                <a-box 
                    id="captionToggleBox"
                    position="-0.3 0.25 0.02"
                    width="0.15"
                    height="0.1"
                    depth="0.01"
                    color="#10B981"
                    opacity="1.0"
                    class="clickable ar-toggle">
                </a-box>
                <a-text 
                    value="Captions: on"
                    position="0.05 0.25 0.02"
                    width="0.9"
                    align="left"
                    color="#FFFFFF"
                    font="roboto">
                </a-text>
                
                <!-- Topic Toggle -->
                <a-box 
                    id="topicToggleBox"
                    position="-0.3 0.0 0.02"
                    width="0.15"
                    height="0.1"
                    depth="0.01"
                    color="#6366F1"
                    opacity="1.0"
                    class="clickable ar-toggle">
                </a-box>
                <a-text 
                    value="Topic: on"
                    position="0.05 0.0 0.02"
                    width="0.9"
                    align="left"
                    color="#FFFFFF"
                    font="roboto">
                </a-text>
                
                <!-- Haptics Toggle -->
                <a-box 
                    id="hapticsToggleBox"
                    position="-0.3 -0.25 0.02"
                    width="0.15"
                    height="0.1"
                    depth="0.01"
                    color="#F59E0B"
                    opacity="1.0"
                    class="clickable ar-toggle">
                </a-box>
                <a-text 
                    value="Haptics: on"
                    position="0.05 -0.25 0.02"
                    width="0.9"
                    align="left"
                    color="#FFFFFF"
                    font="roboto">
                </a-text>
            </a-entity>

            <!-- Microphone Listening Indicator -->
            <a-entity id="micIndicator" position="0.7 0.5 -1.5" visible="false">
                <!-- Outer Pulse Ring -->
                <a-ring 
                    radius-inner="0.08" 
                    radius-outer="0.12" 
                    color="#EF4444" 
                    opacity="0.6"
                    animation="property: scale; to: 1.3 1.3 1; dir: alternate; dur: 800; loop: true; easing: easeInOutQuad">
                </a-ring>
                
                <!-- Inner Circle Background -->
                <a-circle 
                    radius="0.075" 
                    color="#DC2626" 
                    opacity="0.95"
                    position="0 0 0.01">
                </a-circle>
                
                <!-- Microphone Icon -->
                <a-text 
                    value="üé§" 
                    position="0 0 0.02" 
                    align="center" 
                    width="0.4" 
                    color="#FFFFFF"
                    shader="sdf"
                    opacity="1.0">
                </a-text>
                
                <!-- LIVE Label -->
                <a-text 
                    value="LIVE" 
                    position="0 -0.15 0.02" 
                    align="center" 
                    width="0.25" 
                    color="#FFFFFF"
                    shader="sdf"
                    font="roboto"
                    opacity="0.9"
                    animation="property: opacity; to: 0.4; dir: alternate; dur: 600; loop: true">
                </a-text>
            </a-entity>

            <!-- Status Indicator (for debugging) -->
            <a-text 
                id="statusText"
                position="0 -0.5 -2.2"
                value="ClearPath Loading..."
                color="#10B981"
                width="2.5"
                align="center"
                visible="true">
            </a-text>
        </a-camera>

        <!-- Ambient lighting for AR -->
        <a-light type="ambient" color="#404040" intensity="0.5"></a-light>
    </a-scene>

    <!-- AR Control Panel -->
    <div id="arControls" class="ar-controls">
        <div class="control-header">ClearPath Controls</div>
        
        <!-- Primary Action -->
        <button id="enterVRButton" class="ar-button vr-btn">ü•Ω Enter AR Mode</button>
        
        <!-- Feature Controls - Toggleable -->
        <button id="toggleSpeech" class="ar-button toggle-btn speech-btn" data-active="false">
            <span class="toggle-indicator">‚≠ï</span>
            <span class="toggle-label">Captions</span>
        </button>
        
        <button id="toggleAI" class="ar-button toggle-btn ai-btn" data-active="false">
            <span class="toggle-indicator">‚≠ï</span>
            <span class="toggle-label">AI Topics</span>
        </button>
        
        <button id="toggleHaptics" class="ar-button toggle-btn haptics-btn" data-active="false">
            <span class="toggle-indicator">‚≠ï</span>
            <span class="toggle-label">Haptics</span>
        </button>
        
        <!-- System Status -->
        <div id="systemStatus" class="status-panel">
            <div id="bridgeStatus" class="status-item">üîå Bridge: Connecting...</div>
        </div>
        
        <!-- Network Mode Info Banner (shows when via ngrok) -->
        <div id="networkInfo" style="display:none; position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: rgba(250, 204, 21, 0.95); color: #000; padding: 10px 20px; border-radius: 8px; font-size: 14px; z-index: 10000; max-width: 90%; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
            <strong>üåê Public Access Mode</strong><br>
            <span style="font-size: 12px;">iPhone haptics unavailable ‚Ä¢ For full features use: https://172.22.53.62:5500</span>
        </div>
        
        <!-- Test Button (subtle) -->
        <button id="testCaption" class="ar-button test-btn">üîç Test Captions</button>
    </div>

    <script>
        // Initialize ClearPath AR System on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ClearPath AR System Starting...');
            
            // Load user configuration from localStorage or setup
            loadUserConfiguration();
            
            // Initialize WebSocket bridge to laptop
            if (window.bridgeModule) {
                // Allow overriding bridge URL via ?bridge= query param (e.g. for ngrok)
                const urlParams = new URLSearchParams(window.location.search);
                const bridgeParam = urlParams.get('bridge');

                if (bridgeParam) {
                    console.log('Bridge URL from ?bridge= param:', bridgeParam);
                    window.bridgeModule.setServerAddress(bridgeParam);
                    window.bridgeModule.connect();
                } else {
                    const isNgrokOrPublic = window.location.hostname.includes('ngrok') ||
                                           window.location.hostname.includes('loca.lt') ||
                                           window.location.hostname.includes('vercel') ||
                                           window.location.hostname.includes('netlify') ||
                                           !window.location.hostname.match(/^192\.|^172\.|^10\.|localhost/);

                    if (isNgrokOrPublic) {
                        console.log('Public deployment mode - no ?bridge= param provided');
                        setTimeout(() => {
                            const statusEl = document.getElementById('bridgeStatus');
                            if (statusEl) {
                                statusEl.textContent = 'üîå Bridge: Add ?bridge=wss://xxx.ngrok.io';
                                statusEl.classList.add('warning');
                            }
                        }, 1000);
                    } else {
                        console.log('Initializing WebSocket bridge...');
                        window.bridgeModule.setServerAddress('ws://172.22.53.62:8080');
                        window.bridgeModule.connect();
                    }
                }
            } else {
                console.error('Bridge module not loaded!');
            }
            
            // Initialize all AR layers
            initializeCaptionSystem();
            initializeTopicSystem();
            initializeDashboard();
            
            // Set up UI event listeners
            setupUIControls();
            
            // Update status
            updateStatusText('ClearPath Ready - Tap buttons to activate features');
            
            console.log('ClearPath AR System Ready!');
        });

        // Load user configuration
        function loadUserConfiguration() {
            const config = JSON.parse(localStorage.getItem('clearpath-config') || '{}');
            
            if (config.personName) {
                updateDashboard(config.personName, config.relationship);
                console.log('Loaded user configuration:', config);
            } else {
                console.log('No configuration found - using defaults');
                updateDashboard('Listening...', 'Auto-detects from speech');
            }
        }

        // Update dashboard information (notes section removed)
        function updateDashboard(name, relationship) {
            const nameEl = document.getElementById('dashboardName');
            const relationEl = document.getElementById('dashboardRelation');
            
            if (nameEl) nameEl.setAttribute('value', `Person: ${name}`);
            if (relationEl) relationEl.setAttribute('value', `Relationship: ${relationship}`);
        }

        // Initialize live captions
        function initializeCaptionSystem() {
            console.log('Initializing caption system...');
            // This will be expanded by speech-recognition.js
        }

        // Initialize topic conversation system
        function initializeTopicSystem() {
            console.log('Initializing topic system...');
            // This will be expanded by ai-summarizer.js
        }

        // Initialize dashboard
        function initializeDashboard() {
            console.log('Initializing dashboard...');
            // Dashboard is already visible and populated
        }

        // Set up UI control event listeners
        function setupUIControls() {
            // AR Toggle Handlers (for in-VR interaction)
            const captionToggle = document.getElementById('captionToggleBox');
            const topicToggle = document.getElementById('topicToggleBox');
            const hapticsToggle = document.getElementById('hapticsToggleBox');
            
            if (captionToggle) {
                captionToggle.addEventListener('click', function() {
                    const captionBar = document.getElementById('captionBar');
                    const isVisible = captionBar.getAttribute('visible') !== 'false';
                    captionBar.setAttribute('visible', !isVisible);
                    captionToggle.setAttribute('opacity', !isVisible ? '1.0' : '0.4');
                    
                    // Update toggle text
                    const textEl = captionToggle.nextElementSibling;
                    if (textEl && textEl.tagName === 'A-TEXT') {
                        textEl.setAttribute('value', !isVisible ? 'Captions: on' : 'Captions: off');
                    }
                    console.log('Captions toggled:', !isVisible);
                });
            }
            
            if (topicToggle) {
                topicToggle.addEventListener('click', function() {
                    const topicBox = document.getElementById('topicBox');
                    const isVisible = topicBox.getAttribute('visible') !== 'false';
                    topicBox.setAttribute('visible', !isVisible);
                    topicToggle.setAttribute('opacity', !isVisible ? '1.0' : '0.4');
                    
                    // Update toggle text
                    const textEl = topicToggle.nextElementSibling;
                    if (textEl && textEl.tagName === 'A-TEXT') {
                        textEl.setAttribute('value', !isVisible ? 'Topic: on' : 'Topic: off');
                    }
                    console.log('Topics toggled:', !isVisible);
                });
            }
            
            if (hapticsToggle) {
                hapticsToggle.addEventListener('click', function() {
                    const isEnabled = hapticsToggle.getAttribute('data-enabled') !== 'false';
                    hapticsToggle.setAttribute('data-enabled', !isEnabled);
                    hapticsToggle.setAttribute('opacity', !isEnabled ? '1.0' : '0.4');
                    
                    // Update toggle text
                    const textEl = hapticsToggle.nextElementSibling;
                    if (textEl && textEl.tagName === 'A-TEXT') {
                        textEl.setAttribute('value', !isEnabled ? 'Haptics: on' : 'Haptics: off');
                    }
                    
                    // Set global haptics flag for haptic feedback system
                    window.hapticsEnabled = !isEnabled;
                    console.log('Haptics toggled:', !isEnabled);
                });
            }
            
            // Test Caption Button
            document.getElementById('testCaption').addEventListener('click', function() {
                const testText = 'Test caption - if you can read this, captions work!';
                window.updateCaption(testText);
                console.log('Test caption displayed');
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    window.updateCaption('');
                }, 3000);
            });
            
            // Enter VR Button
            document.getElementById('enterVRButton').addEventListener('click', function() {
                const sceneEl = document.querySelector('a-scene');
                if (sceneEl) {
                    sceneEl.enterVR();
                    console.log('Entering VR/AR mode...');
                }
            });
            
            // Speech Recognition Toggle
            const speechBtn = document.getElementById('toggleSpeech');
            speechBtn.addEventListener('click', async function() {
                const isActive = speechBtn.getAttribute('data-active') === 'true';
                
                if (!isActive) {
                    // Turning ON
                    try {
                        await navigator.mediaDevices.getUserMedia({ audio: true });
                        console.log('Microphone permission granted');
                        
                        if (window.speechModule) {
                            window.speechModule.start();
                            updateToggleButton(speechBtn, true);
                        } else {
                            console.error('Speech module not loaded');
                        }
                    } catch (err) {
                        console.error('Microphone permission denied:', err);
                        alert('Microphone access required. Enable permissions in browser settings.');
                    }
                } else {
                    // Turning OFF
                    if (window.speechModule && window.speechModule.stop) {
                        window.speechModule.stop();
                    }
                    updateToggleButton(speechBtn, false);
                }
            });

            // AI Summarization Toggle
            const aiBtn = document.getElementById('toggleAI');
            aiBtn.addEventListener('click', function() {
                const isActive = aiBtn.getAttribute('data-active') === 'true';
                
                if (!isActive) {
                    // Turning ON
                    if (window.aiModule) {
                        window.aiModule.start();
                        updateToggleButton(aiBtn, true);
                    } else {
                        console.error('AI module not loaded');
                    }
                } else {
                    // Turning OFF
                    if (window.aiModule && window.aiModule.stop) {
                        window.aiModule.stop();
                    }
                    updateToggleButton(aiBtn, false);
                }
            });
            
            // Haptics Toggle
            const hapticsBtn = document.getElementById('toggleHaptics');
            hapticsBtn.addEventListener('click', function() {
                const isActive = hapticsBtn.getAttribute('data-active') === 'true';
                window.hapticsEnabled = !isActive;
                updateToggleButton(hapticsBtn, !isActive);
                console.log('Haptics:', !isActive ? 'enabled' : 'disabled');
            });
            
            // Helper function to update toggle button state
            function updateToggleButton(btn, isActive) {
                btn.setAttribute('data-active', isActive.toString());
                const indicator = btn.querySelector('.toggle-indicator');
                if (indicator) {
                    indicator.textContent = isActive ? '‚úÖ' : '‚≠ï';
                }
            }
        }

        // Update status text in AR view
        function updateStatusText(message) {
            const statusEl = document.getElementById('statusText');
            if (statusEl) {
                statusEl.setAttribute('value', message);
            }
            console.log('Status:', message);
        }

        // Update captions (called by speech-recognition.js)
        window.updateCaption = function(text) {
            const captionText = document.getElementById('captionText');
            const captionBg = document.getElementById('captionBg');
            
            console.log('updateCaption called with:', text);
            
            if (captionText && captionBg) {
                if (text && text.trim()) {
                    console.log('Setting caption text to:', text);
                    
                    // Set via <a-text> primitive attribute (reliable in A-Frame 1.4.0)
                    captionText.setAttribute('value', text);
                    captionText.setAttribute('visible', true);
                    captionBg.setAttribute('visible', true);

                    console.log('Caption text set successfully');
                } else {
                    // Show placeholder instead of hiding
                    captionText.setAttribute('value', 'Captions will be added here');
                    captionText.setAttribute('visible', true);
                    captionBg.setAttribute('visible', true);
                }
            } else {
                console.error('Caption elements not found!');
            }
        };

        // Update topic (called by ai-summarizer.js)
        window.updateTopic = function(topic) {
            const topicContent = document.getElementById('topicContent');
            const topicBg = document.getElementById('topicBg');
            
            if (topicContent && topicBg) {
                if (topic && topic.trim()) {
                    topicContent.setAttribute('value', topic);
                    topicContent.setAttribute('visible', true);
                    topicBg.setAttribute('visible', true);
                } else {
                    // Show placeholder instead of hiding
                    topicContent.setAttribute('value', 'Topic of conversation');
                    topicContent.setAttribute('visible', true);
                    topicBg.setAttribute('visible', true);
                }
                
                console.log('Topic updated:', topic);
            } else {
                console.error('Topic elements not found!');
            }
        };

        // Global error handling for AR
        window.addEventListener('error', function(e) {
            console.error('ClearPath AR Error:', e.error);
            updateStatusText('Error: ' + e.error.message);
        });

        // XR session management
        if (navigator.xr) {
            navigator.xr.isSessionSupported('immersive-ar').then(function(supported) {
                if (supported) {
                    console.log('WebXR AR supported');
                    updateStatusText('ClearPath Ready - WebXR AR Available');
                } else {
                    console.warn('WebXR AR not supported');
                    updateStatusText('Warning: WebXR AR not supported on this device');
                }
            });
        } else {
            console.warn('WebXR not available');
            updateStatusText('Warning: WebXR not available - use Meta Quest 3 browser');
        }
    </script>
</body>
</html>